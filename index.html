<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CrossRealm Admin Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 250px;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            overflow-y: auto;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .nav-item {
            padding: 12px 16px;
            margin-bottom: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .nav-item:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .nav-item.active {
            background: rgba(255,255,255,0.2);
        }
        
        .wallet-info {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 12px;
            word-break: break-all;
        }
        
        /* Main Content */
        .main-content {
            margin-left: 250px;
            padding: 30px;
        }
        
        .header {
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 32px;
            color: #1a1a1a;
            margin-bottom: 8px;
        }
        
        .header p {
            color: #666;
            font-size: 16px;
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #1a1a1a;
        }
        
        .stat-change {
            font-size: 14px;
            margin-top: 8px;
        }
        
        .stat-change.positive {
            color: #4caf50;
        }
        
        .stat-change.negative {
            color: #f44336;
        }
        
        /* Cards */
        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .card-title {
            font-size: 20px;
            font-weight: bold;
            color: #1a1a1a;
        }
        
        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .badge-success {
            background: #4caf50;
            color: white;
        }
        
        .badge-warning {
            background: #ff9800;
            color: white;
        }
        
        .badge-info {
            background: #2196f3;
            color: white;
        }
        
        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: #4caf50;
            color: white;
        }
        
        .btn-danger {
            background: #f44336;
            color: white;
        }
        
        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Tables */
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table th {
            text-align: left;
            padding: 12px;
            background: #f5f5f5;
            font-weight: 600;
            color: #666;
            font-size: 14px;
        }
        
        .table td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        /* Chart Container */
        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }
        .chart-container.small {
            height: 250px;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Status Indicators */
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-dot.green {
            background: #4caf50;
        }
        
        .status-dot.red {
            background: #f44336;
        }
        
        .status-dot.yellow {
            background: #ff9800;
        }
        
        /* Hidden */
        .hidden {
            display: none !important;
        }
        
        /* Connect Section */
        .connect-container {
            max-width: 500px;
            margin: 100px auto;
            text-align: center;
        }
        
        .connect-card {
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
        }
        
        .connect-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }
        
        /* Phase Cards */
        .phase-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .phase-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #e0e0e0;
        }
        
        .phase-card.enabled {
            border-left-color: #4caf50;
            background: #f1f8f4;
        }
        
        /* Pool Cards */
        .pool-card {
            background: rgba(76, 175, 80, 0.1);
            border: 2px solid #4caf50;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .pool-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .pool-stat {
            text-align: center;
            padding: 15px;
            background: rgba(0,0,0,0.05);
            border-radius: 6px;
        }
        
        .pool-stat .value {
            font-size: 24px;
            font-weight: bold;
            color: #4caf50;
            margin-bottom: 5px;
        }
        
        .pool-stat .label {
            font-size: 11px;
            color: #666;
            text-transform: uppercase;
        }
        
        /* Balance Cards Grid */
        .balance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .balance-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .balance-card:hover {
            transform: translateY(-5px);
            border-color: #667eea;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        .balance-card.hub { border-color: #667eea; }
        .balance-card.rewards { border-color: #ff9800; }
        .balance-card.staking { border-color: #4caf50; }
        .balance-card.dev { border-color: #764ba2; }
        
        .balance-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        .balance-icon {
            font-size: 32px;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            background: rgba(102, 126, 234, 0.1);
        }
        .balance-card-title {
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #666;
        }
        .balance-amount {
            font-size: 36px;
            font-weight: bold;
            color: #1a1a1a;
            margin: 10px 0;
        }
        .balance-label {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }
        .balance-details {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
            font-size: 13px;
            line-height: 1.8;
        }
        .balance-details div {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }
        
        /* Grid Layout */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
            }
            
            .main-content {
                margin-left: 200px;
                padding: 20px;
            }
            
            .stats-grid, .grid, .grid-3 {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Connect Section -->
    <div id="connectSection">
        <div class="connect-container">
            <div class="connect-card">
                <div class="connect-icon">üéÆ</div>
                <h1>CrossRealm Admin Dashboard</h1>
                <p style="margin: 20px 0; color: #666;">Connect your wallet to access admin features</p>
                <button class="btn btn-primary" onclick="connectWallet()" style="width: 100%;">
                    üîó Connect MetaMask
                </button>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboardSection" class="hidden">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">üéÆ CrossRealm</div>
            
            <div class="wallet-info">
                <strong>Connected:</strong><br>
                <span id="walletAddress"></span><br>
                <strong style="color: #4caf50;" id="devBalanceDisplay">0 CORE</strong>
            </div>
            
            <div class="nav-item active" onclick="showSection('overview')">
                üìä Overview
            </div>
            <div class="nav-item" onclick="showSection('analytics')">
                üìà Analytics
            </div>
            <div class="nav-item" onclick="showSection('staking')">
                üíé Staking
            </div>
            <div class="nav-item" onclick="showSection('phases')">
                üîå Phase Control
            </div>
            <div class="nav-item" onclick="showSection('treasury')">
                üí∞ Treasury
            </div>
            <div class="nav-item" onclick="showSection('pools')">
                üèÜ Prize Pools
            </div>
            <div class="nav-item" onclick="showSection('games')">
                üéØ Live Games
            </div>
            <div class="nav-item" onclick="showSection('settings')">
                ‚öôÔ∏è Settings
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Overview Section -->
            <div id="overviewSection">
                <div class="header">
                    <h1>üìä Platform Overview</h1>
                    <p>Real-time statistics and platform health</p>
                </div>

                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Games</div>
                        <div class="stat-value" id="totalGames">-</div>
                        <div class="stat-change positive" id="gamesChange">+0 today</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">Total Volume</div>
                        <div class="stat-value" id="totalVolume">-</div>
                        <div class="stat-change positive" id="volumeChange">+0 CORE</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">Active Players</div>
                        <div class="stat-value" id="activePlayers">-</div>
                        <div class="stat-change positive" id="playersChange">+0 this week</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">Dev Revenue</div>
                        <div class="stat-value" id="devRevenue">-</div>
                        <div class="stat-change positive" id="revenueChange">Available</div>
                    </div>
                </div>

                <!-- Balance Cards -->
                <div class="balance-grid">
                    <!-- Hub Balance -->
                    <div class="balance-card hub">
                        <div class="balance-card-header">
                            <div class="balance-icon">üè¶</div>
                            <div>
                                <div class="balance-card-title">Hub Contract</div>
                                <div style="font-size: 11px; color: #999;">Game Stakes Escrow</div>
                            </div>
                        </div>
                        <div class="balance-amount" id="hubBalance">0.0000</div>
                        <div class="balance-label">CORE</div>
                        <div class="balance-details">
                            <div>
                                <span>Active Games:</span>
                                <strong id="activeGamesCount">0</strong>
                            </div>
                            <div>
                                <span>Total Volume:</span>
                                <strong id="totalVolumeHub">0 CORE</strong>
                            </div>
                        </div>
                    </div>

                    <!-- Rewards Balance -->
                    <div class="balance-card rewards">
                        <div class="balance-card-header">
                            <div class="balance-icon">üí∞</div>
                            <div>
                                <div class="balance-card-title">Rewards Contract</div>
                                <div style="font-size: 11px; color: #999;">Fee Distribution Pool</div>
                            </div>
                        </div>
                        <div class="balance-amount" id="rewardsBalance">0.0000</div>
                        <div class="balance-label">CORE</div>
                        <div class="balance-details">
                            <div>
                                <span>Dev Allocation:</span>
                                <strong id="devAllocation">0 CORE</strong>
                            </div>
                            <div>
                                <span>Player Cashback:</span>
                                <strong id="playerCashbackPool">0 CORE</strong>
                            </div>
                        </div>
                    </div>

                    <!-- Staking Balance -->
                    <div class="balance-card staking">
                        <div class="balance-card-header">
                            <div class="balance-icon">üíé</div>
                            <div>
                                <div class="balance-card-title">Staking Contract</div>
                                <div style="font-size: 11px; color: #999;">Staking Rewards Pool</div>
                            </div>
                        </div>
                        <div class="balance-amount" id="stakingBalance">0.0000</div>
                        <div class="balance-label">CORE</div>
                        <div class="balance-details">
                            <div>
                                <span>Total Staked:</span>
                                <strong id="totalStakedAmount">0 CORE</strong>
                            </div>
                            <div>
                                <span>Your Stake:</span>
                                <strong id="devStakedAmount">0 CORE</strong>
                            </div>
                        </div>
                    </div>

                    <!-- Dev Claimable -->
                    <div class="balance-card dev">
                        <div class="balance-card-header">
                            <div class="balance-icon">üéÅ</div>
                            <div>
                                <div class="balance-card-title">Dev Claimable</div>
                                <div style="font-size: 11px; color: #999;">Your Earnings</div>
                            </div>
                        </div>
                        <div class="balance-amount" id="devClaimable">0.0000</div>
                        <div class="balance-label">CORE</div>
                        <div class="balance-details">
                            <div>
                                <span>Platform Revenue:</span>
                                <strong id="platformRevenue">0 CORE</strong>
                            </div>
                            <div>
                                <span>Staking Rewards:</span>
                                <strong id="devStakingRewards">0 CORE</strong>
                            </div>
                        </div>
                        <button onclick="claimDevRevenue()" class="btn btn-success" style="width: 100%; margin-top: 15px;">
                            üíµ Claim All
                        </button>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">‚ö° Quick Actions</h2>
                    </div>
                    <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                        <button class="btn btn-success" onclick="claimDevPot()">
                            üí∞ Claim Dev Pot
                        </button>
                        <button class="btn btn-primary" onclick="refreshData()">
                            üîÑ Refresh Data
                        </button>
                        <button class="btn btn-secondary" onclick="exportData()">
                            üì• Export Report
                        </button>
                    </div>
                </div>

                <!-- Platform Status -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">üîå Platform Status</h2>
                    </div>
                    <table class="table">
                        <tr>
                            <td><span class="status-dot green"></span>Phase 1: Core</td>
                            <td><span class="badge badge-success">LIVE</span></td>
                            <td>All systems operational</td>
                        </tr>
                        <tr>
                            <td><span class="status-dot" id="phase2Dot"></span>Phase 2: Multi-Token</td>
                            <td><span class="badge" id="phase2StatusBadge">CHECKING...</span></td>
                            <td id="phase2StatusText">Checking status...</td>
                        </tr>
                        <tr>
                            <td><span class="status-dot" id="phase3Dot"></span>Phase 3: Cross-Chain</td>
                            <td><span class="badge" id="phase3StatusBadge">CHECKING...</span></td>
                            <td id="phase3StatusText">Checking status...</td>
                        </tr>
                        <tr>
                            <td><span class="status-dot" id="phase4Dot"></span>Phase 4: Governance</td>
                            <td><span class="badge" id="phase4StatusBadge">CHECKING...</span></td>
                            <td id="phase4StatusText">Checking status...</td>
                        </tr>
                    </table>
                </div>
            </div>

            <!-- Analytics Section -->
            <div id="analyticsSection" class="hidden">
                <div class="header">
                    <h1>üìà Platform Analytics</h1>
                    <p>Detailed insights and trends</p>
                </div>

                <!-- Charts Grid -->
                <div class="grid">
                    <!-- Revenue Chart -->
                    <div class="card">
                        <h3 style="color: #667eea; margin-bottom: 20px;">üìä Revenue Over Time</h3>
                        <div class="chart-container">
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </div>

                    <!-- Games Chart -->
                    <div class="card">
                        <h3 style="color: #667eea; margin-bottom: 20px;">üéÆ Games Played</h3>
                        <div class="chart-container">
                            <canvas id="gamesChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Pie Charts Grid -->
                <div class="grid-3">
                    <!-- Fee Distribution Pie -->
                    <div class="card">
                        <h3 style="color: #667eea; margin-bottom: 20px;">üí∞ Fee Distribution</h3>
                        <div class="chart-container small">
                            <canvas id="feeDistributionChart"></canvas>
                        </div>
                    </div>

                    <!-- Pool Balances Pie -->
                    <div class="card">
                        <h3 style="color: #667eea; margin-bottom: 20px;">üè¶ Pool Balances</h3>
                        <div class="chart-container small">
                            <canvas id="poolBalancesChart"></canvas>
                        </div>
                    </div>

                    <!-- Game Types Pie -->
                    <div class="card">
                        <h3 style="color: #667eea; margin-bottom: 20px;">üéØ Game Types</h3>
                        <div class="chart-container small">
                            <canvas id="gameTypesChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Stats Table -->
                <div class="card">
                    <h3 style="color: #667eea; margin-bottom: 20px;">üìà Platform Metrics</h3>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Metric</th>
                                <th style="text-align: right;">Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Total Games Played</td>
                                <td style="text-align: right;" id="analyticsGames">0</td>
                            </tr>
                            <tr>
                                <td>Total Volume Wagered</td>
                                <td style="text-align: right;" id="analyticsVolume">0 CORE</td>
                            </tr>
                            <tr>
                                <td>Total Fees Collected</td>
                                <td style="text-align: right;" id="analyticsFees">0 CORE</td>
                            </tr>
                            <tr>
                                <td>Dev Revenue (54%)</td>
                                <td style="text-align: right;" id="analyticsDevRevenue">0 CORE</td>
                            </tr>
                            <tr>
                                <td>Player Cashback (14%)</td>
                                <td style="text-align: right;" id="analyticsCashback">0 CORE</td>
                            </tr>
                            <tr>
                                <td>Staking Rewards (14%)</td>
                                <td style="text-align: right;" id="analyticsStakingRewards">0 CORE</td>
                            </tr>
                            <tr>
                                <td>Referral Rewards (10%)</td>
                                <td style="text-align: right;" id="analyticsReferrals">0 CORE</td>
                            </tr>
                            <tr>
                                <td>Creator Bonuses (8%)</td>
                                <td style="text-align: right;" id="analyticsCreator">0 CORE</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Staking Section -->
            <div id="stakingSection" class="hidden">
                <div class="header">
                    <h1>üíé Staking Management</h1>
                    <p>Stake as a user and manage staking pools</p>
                </div>

                <div class="grid">
                    <div class="card">
                        <h3 style="color: #667eea; margin-bottom: 20px;">üíé Your Staking (As User)</h3>
                        <p style="color: #666; margin-bottom: 20px; font-size: 13px;">
                            Stake CORE just like any user. Earn from the 14% staking pool allocation.
                        </p>
                        <label class="form-label">Amount to Stake</label>
                        <input type="number" id="stakeAmount" class="form-input" placeholder="1.0" min="0.01" step="0.01" value="1">
                        <div class="action-buttons">
                            <button onclick="stakeTokens()" class="btn btn-success">üíé Stake</button>
                            <button onclick="unstakeTokens()" class="btn btn-danger">üì§ Unstake</button>
                            <button onclick="claimStakingRewards()" class="btn btn-primary">üí∞ Claim Rewards</button>
                        </div>
                    </div>

                    <div class="card">
                        <h3 style="color: #667eea; margin-bottom: 20px;">üìä Your Staking Info</h3>
                        <table class="table">
                            <tr>
                                <td>Your Staked Amount</td>
                                <td style="text-align: right;"><strong id="yourStake">0 CORE</strong></td>
                            </tr>
                            <tr>
                                <td>Your Share of Pool</td>
                                <td style="text-align: right;"><strong id="yourPoolShare">0%</strong></td>
                            </tr>
                            <tr>
                                <td>Earned Rewards</td>
                                <td style="text-align: right;"><strong id="earnedStakingRewards">0 CORE</strong></td>
                            </tr>
                            <tr>
                                <td>APY (Estimated)</td>
                                <td style="text-align: right;"><strong style="color: #4caf50;">10-14%</strong></td>
                            </tr>
                            <tr>
                                <td>Total Platform Staked</td>
                                <td style="text-align: right;"><strong id="platformTotalStaked">0 CORE</strong></td>
                            </tr>
                        </table>
                    </div>
                </div>

                <!-- Admin Staking Controls -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">üè¶ Admin Staking Controls</h2>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Top-Up Staking Pool</label>
                        <input type="number" id="topUpAmount" class="form-input" placeholder="Amount in CORE" step="0.01">
                    </div>
                    <button class="btn btn-primary" onclick="topUpStaking()" style="width: 100%;">
                        üíµ Top-Up Staking Pool
                    </button>
                </div>
            </div>

            <!-- Phase Control Section -->
            <div id="phasesSection" class="hidden">
                <div class="header">
                    <h1>üîå Phase Control</h1>
                    <p>Enable platform features with one click</p>
                </div>

                <div class="phase-grid">
                    <!-- Phase 2 -->
                    <div class="phase-card" id="phase2Card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                            <h3>Phase 2: Multi-Token</h3>
                            <span class="badge" id="phase2Badge">DISABLED</span>
                        </div>
                        <p style="color: #666; margin-bottom: 16px;">
                            Allow players to stake with USDT, USDC, and other ERC20 tokens. 
                            Automatically swaps to CORE via DEX.
                        </p>
                        <button class="btn btn-primary" id="phase2Btn" onclick="enablePhase2()" style="width: 100%;">
                            üöÄ Enable Phase 2
                        </button>
                        <div id="phase2Status" style="margin-top: 12px;"></div>
                    </div>

                    <!-- Phase 3 -->
                    <div class="phase-card" id="phase3Card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                            <h3>Phase 3: Cross-Chain</h3>
                            <span class="badge" id="phase3Badge">DISABLED</span>
                        </div>
                        <p style="color: #666; margin-bottom: 16px;">
                            Enable players from BSC, Arbitrum, and other chains to play using LayerZero.
                        </p>
                        <button class="btn btn-primary" id="phase3Btn" onclick="enablePhase3()" style="width: 100%;">
                            üöÄ Enable Phase 3
                        </button>
                        <div id="phase3Status" style="margin-top: 12px;"></div>
                    </div>

                    <!-- Phase 4 -->
                    <div class="phase-card" id="phase4Card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                            <h3>Phase 4: Governance</h3>
                            <span class="badge" id="phase4Badge">DISABLED</span>
                        </div>
                        <p style="color: #666; margin-bottom: 16px;">
                            Enable DAO governance with REALM tokens. Community can vote on proposals.
                        </p>
                        <button class="btn btn-primary" id="phase4Btn" onclick="enablePhase4()" style="width: 100%;">
                            üöÄ Enable Phase 4
                        </button>
                        <div id="phase4Status" style="margin-top: 12px;"></div>
                    </div>
                </div>
            </div>

            <!-- Treasury Section -->
            <div id="treasurySection" class="hidden">
                <div class="header">
                    <h1>üí∞ Treasury Management</h1>
                    <p>Manage platform funds and revenue</p>
                </div>

                <!-- Treasury Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Available to Claim</div>
                        <div class="stat-value" id="treasuryClaimable">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Claimed</div>
                        <div class="stat-value" id="treasuryTotalClaimed">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Contract Balance</div>
                        <div class="stat-value" id="treasuryContractBalance">-</div>
                    </div>
                </div>

                <!-- Claim Form -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">üí∏ Claim Dev Revenue</h2>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Select Month</label>
                        <select id="claimMonth" class="form-input">
                            <!-- Populated dynamically -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Amount Available</label>
                        <div style="font-size: 24px; font-weight: bold; color: #4caf50;" id="claimAmount">
                            0 CORE
                        </div>
                    </div>
                    <button class="btn btn-success" onclick="claimDevPotForMonth()" style="width: 100%;">
                        üí∞ Claim Revenue
                    </button>
                </div>
            </div>

            <!-- Prize Pools Section -->
            <div id="poolsSection" class="hidden">
                <div class="header">
                    <h1>üèÜ Prize Pool Management</h1>
                    <p>Manage tournament and community prize pools</p>
                </div>

                <!-- Pool Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Tournament Pool</div>
                        <div class="stat-value" id="tournamentPoolSize">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Community Contributions</div>
                        <div class="stat-value" id="communityContributions">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Platform Contributions</div>
                        <div class="stat-value" id="platformContributions">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Next Tournament</div>
                        <div class="stat-value" id="nextTournament">Soon</div>
                    </div>
                </div>

                <!-- Tournament Pool Card -->
                <div class="pool-card">
                    <h3 style="color: #4caf50; margin-bottom: 15px;">üí∞ Tournament Prize Pool</h3>
                    <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
                        Add funds to the tournament prize pool to increase winner rewards and attract more players.
                    </p>
                    <div class="pool-stats">
                        <div class="pool-stat">
                            <div class="value" id="totalPoolValue">0</div>
                            <div class="label">Total Pool (CORE)</div>
                        </div>
                        <div class="pool-stat">
                            <div class="value" id="contributorsCount">0</div>
                            <div class="label">Contributors</div>
                        </div>
                        <div class="pool-stat">
                            <div class="value" id="averageContribution">0</div>
                            <div class="label">Avg Contribution</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Contribution Amount (CORE)</label>
                        <input type="number" id="poolContributionAmount" class="form-input" placeholder="1.0" step="0.01">
                    </div>
                    <button class="btn btn-success" onclick="contributeToTournamentPool()" style="width: 100%;">
                        üéÅ Contribute to Prize Pool
                    </button>
                </div>

                <!-- Staking Pool Contribution -->
                <div class="pool-card" style="background: rgba(102, 126, 234, 0.1); border-color: #667eea;">
                    <h3 style="color: #667eea; margin-bottom: 15px;">üíé Staking Rewards Pool</h3>
                    <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
                        Boost the staking rewards pool to increase APY and attract more stakers.
                    </p>
                    <div class="form-group">
                        <label class="form-label">Contribution Amount (CORE)</label>
                        <input type="number" id="stakingPoolAmount" class="form-input" placeholder="1.0" step="0.01">
                    </div>
                    <button class="btn btn-primary" onclick="contributeToStakingPool()" style="width: 100%;">
                        üíµ Contribute to Staking Pool
                    </button>
                </div>

                <!-- Rewards Pool Contribution -->
                <div class="pool-card" style="background: rgba(255, 152, 0, 0.1); border-color: #ff9800;">
                    <h3 style="color: #ff9800; margin-bottom: 15px;">üéÅ Cashback Rewards Pool</h3>
                    <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
                        Add to the cashback pool to increase player rewards on every game.
                    </p>
                    <div class="form-group">
                        <label class="form-label">Contribution Amount (CORE)</label>
                        <input type="number" id="rewardsPoolAmount" class="form-input" placeholder="1.0" step="0.01">
                    </div>
                    <button class="btn btn-primary" onclick="contributeToRewardsPool()" style="width: 100%; background: #ff9800;">
                        üéÅ Contribute to Rewards Pool
                    </button>
                </div>
            </div>

            <!-- Live Games Section -->
            <div id="gamesSection" class="hidden">
                <div class="header">
                    <h1>üéØ Live Games</h1>
                    <p>Currently active games on the platform</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Active Games</h2>
                        <span class="badge badge-info" id="liveActiveGamesCount">0</span>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Game ID</th>
                                <th>Type</th>
                                <th>Stake</th>
                                <th>Players</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="gamesTableBody">
                            <tr>
                                <td colspan="6" class="loading">
                                    <div class="spinner"></div>
                                    Loading games...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settingsSection" class="hidden">
                <div class="header">
                    <h1>‚öôÔ∏è Contract Settings</h1>
                    <p>Manage contract addresses and configuration</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">üìã Contract Addresses</h2>
                    </div>
                    <table class="table">
                        <tr>
                            <td><strong>Hub</strong></td>
                            <td><code id="hubAddress"></code></td>
                            <td><button class="btn btn-secondary" onclick="copyAddress('hub')">üìã Copy</button></td>
                        </tr>
                        <tr>
                            <td><strong>Rewards</strong></td>
                            <td><code id="rewardsAddress"></code></td>
                            <td><button class="btn btn-secondary" onclick="copyAddress('rewards')">üìã Copy</button></td>
                        </tr>
                        <tr>
                            <td><strong>Staking</strong></td>
                            <td><code id="stakingAddress"></code></td>
                            <td><button class="btn btn-secondary" onclick="copyAddress('staking')">üìã Copy</button></td>
                        </tr>
                        <tr>
                            <td><strong>NFT</strong></td>
                            <td><code id="nftAddress"></code></td>
                            <td><button class="btn btn-secondary" onclick="copyAddress('nft')">üìã Copy</button></td>
                        </tr>
                        <tr>
                            <td><strong>Game Chat</strong></td>
                            <td><code id="chatAddress"></code></td>
                            <td><button class="btn btn-secondary" onclick="copyAddress('chat')">üìã Copy</button></td>
                        </tr>
                        <tr>
                            <td><strong>Token Gateway</strong></td>
                            <td><code id="gatewayAddress"></code></td>
                            <td><button class="btn btn-secondary" onclick="copyAddress('gateway')">üìã Copy</button></td>
                        </tr>
                        <tr>
                            <td><strong>Bridge</strong></td>
                            <td><code id="bridgeAddress"></code></td>
                            <td><button class="btn btn-secondary" onclick="copyAddress('bridge')">üìã Copy</button></td>
                        </tr>
                        <tr>
                            <td><strong>Tournament</strong></td>
                            <td><code id="tournamentAddress"></code></td>
                            <td><button class="btn btn-secondary" onclick="copyAddress('tournament')">üìã Copy</button></td>
                        </tr>
                        <tr>
                            <td><strong>DAO</strong></td>
                            <td><code id="daoAddress"></code></td>
                            <td><button class="btn btn-secondary" onclick="copyAddress('dao')">üìã Copy</button></td>
                        </tr>
                        <tr>
                            <td><strong>REALM Token</strong></td>
                            <td><code id="realmAddress"></code></td>
                            <td><button class="btn btn-secondary" onclick="copyAddress('realm')">üìã Copy</button></td>
                        </tr>
                    </table>
                </div>

                <!-- Platform Controls -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">üéõÔ∏è Platform Controls</h2>
                    </div>
                    <div style="display: grid; gap: 12px;">
                        <button class="btn btn-danger" onclick="pausePlatform()">
                            ‚è∏Ô∏è Pause Platform
                        </button>
                        <button class="btn btn-success" onclick="unpausePlatform()">
                            ‚ñ∂Ô∏è Resume Platform
                        </button>
                    </div>
                    <div style="background: rgba(244, 67, 54, 0.1); padding: 15px; border-radius: 8px; margin-top: 15px;">
                        <strong style="color: #f44336;">‚ö†Ô∏è Warning:</strong>
                        <p style="font-size: 13px; color: #666; margin-top: 5px;">
                            Pausing the platform will prevent new game creation. Use only in emergencies.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== CONFIGURATION ====================
        const CONTRACTS = {
            HUB: '0x2D0FA241F72B8d9576876E43643374e7088C677f',
            REWARDS: '0x1ab31E3FBbEE0228AB83276c2C74a42fe3DB3bDc',
            STAKING: '0x0be0E11A9b2C214B8615C749F5f438C400B9e0DF',
            NFT: '0x92F172efAb481E40d03FC34102DfC9344fE52f68',
            GAME_CHAT: '0xA0b4c7DCc814D088aA4dBf323D8aA3Df0c6948C4',
            VERIFIERS: {
                CHESS: '0x252C94b74B52a44b6032c940369e9f50387E2AE1',
                CHECKERS: '0x3Af55Fd76cfbFCa1584B4d3dE79Ce152729Dc521'
            },
            TOKEN_GATEWAY: '0xA0eE238f76e2E9B03Ae3bA7A2a013523870137fb',
            BRIDGE: '0xA0484D136c4C5324e12834831E492B613445a041',
            TOURNAMENT: '0x19A21BB2283C08a8d3b32D1BCFb5285ECd1997ed',
            DAO: '0x9E1e6696EEcCbEC531De77a5d17c28D8784645Fb',
            REALM_TOKEN: '0x9445197Ae66EA083869aCDEc822bb2B98678a5d7'
        };

        const HUB_ABI = [
            'function gameCount() view returns (uint)',
            'function games(uint) view returns (uint id, string gameType, uint stake, address token, address creator, address player2, bool isAI, bool isPrivate, address referral, bool zeroGas, bool active, string fen, address verifier, uint turn)',
            'function owner() view returns (address)',
            'function paused() view returns (bool)',
            'function pause() external',
            'function unpause() external'
        ];

        const REWARDS_ABI = [
            'function monthlyDevPotCORE(uint) view returns (uint)',
            'function devWithdrawCORE(uint) external',
            'function owner() view returns (address)',
            'function getTotalClaimable(address user, address token, uint256 timestamp) view returns (uint256)',
            'function claimRewards(address user, address token, uint256 timestamp)'
        ];

        const STAKING_ABI = [
            'function balances(address) view returns (uint256)',
            'function totalSupply() view returns (uint256)',
            'function stake() payable',
            'function withdraw(uint256 amount)',
            'function claimRewards()',
            'function contributeFunds(uint) external payable'
        ];

        const GATEWAY_ABI = [
            'function enabled() view returns (bool)',
            'function enable() external'
        ];

        const BRIDGE_ABI = [
            'function enabled() view returns (bool)',
            'function enable() external'
        ];

        const TOURNAMENT_ABI = [
            'function enabled() view returns (bool)',
            'function enable() external'
        ];

        const DAO_ABI = [
            'function enabled() view returns (bool)',
            'function enable() external'
        ];

        const REALM_ABI = [
            'function tradingEnabled() view returns (bool)',
            'function enableTrading() external'
        ];

        let provider, signer, userAddress;
        let charts = {};
        let autoRefreshInterval;

        // ==================== INITIALIZATION ====================
        async function connectWallet() {
            try {
                if (!window.ethereum) {
                    alert('Please install MetaMask!');
                    return;
                }

                provider = new ethers.providers.Web3Provider(window.ethereum);
                await provider.send("eth_requestAccounts", []);
                signer = provider.getSigner();
                userAddress = await signer.getAddress();

                const hubContract = new ethers.Contract(CONTRACTS.HUB, HUB_ABI, signer);
                const owner = await hubContract.owner();

                if (userAddress.toLowerCase() !== owner.toLowerCase()) {
                    alert('‚ö†Ô∏è You are not the contract owner!\n\nOnly the owner can access the admin dashboard.');
                    return;
                }

                document.getElementById('connectSection').classList.add('hidden');
                document.getElementById('dashboardSection').classList.remove('hidden');
                document.getElementById('walletAddress').textContent = 
                    userAddress.slice(0, 6) + '...' + userAddress.slice(-4);

                await initializeDashboard();
                initCharts();
                startAutoRefresh();

            } catch (error) {
                console.error('Connection error:', error);
                alert('Failed to connect: ' + error.message);
            }
        }

        async function initializeDashboard() {
            await Promise.all([
                updateDevBalance(),
                loadOverviewData(),
                checkAllPhases(),
                loadTreasuryData(),
                loadStakingData(),
                loadPoolData(),
                loadGamesData(),
                updateAnalytics()
            ]);

            updateContractAddresses();
        }

        function startAutoRefresh() {
            autoRefreshInterval = setInterval(() => {
                updateDevBalance();
                if (!document.getElementById('overviewSection').classList.contains('hidden')) {
                    loadOverviewData();
                }
            }, 30000);
        }

        // ==================== BALANCE ====================
        async function updateDevBalance() {
            if (!provider || !userAddress) return;
            try {
                const balance = await provider.getBalance(userAddress);
                document.getElementById('devBalanceDisplay').textContent = 
                    parseFloat(ethers.utils.formatEther(balance)).toFixed(4) + ' CORE';
            } catch (e) {
                console.error('Balance update error:', e);
            }
        }

        // ==================== NAVIGATION ====================
        function showSection(section) {
            const sections = ['overview', 'analytics', 'staking', 'phases', 'treasury', 'pools', 'games', 'settings'];
            sections.forEach(s => {
                document.getElementById(s + 'Section').classList.add('hidden');
            });

            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            document.getElementById(section + 'Section').classList.remove('hidden');
            event.target.classList.add('active');

            switch(section) {
                case 'analytics':
                    updateCharts();
                    break;
                case 'games':
                    loadGamesData();
                    break;
                case 'staking':
                    loadStakingData();
                    break;
                case 'pools':
                    loadPoolData();
                    break;
            }
        }

        // ==================== OVERVIEW ====================
        async function loadOverviewData() {
            try {
                const hub = new ethers.Contract(CONTRACTS.HUB, HUB_ABI, provider);
                const rewards = new ethers.Contract(CONTRACTS.REWARDS, REWARDS_ABI, provider);
                const staking = new ethers.Contract(CONTRACTS.STAKING, STAKING_ABI, provider);

                const gameCount = await hub.gameCount();
                document.getElementById('totalGames').textContent = gameCount.toString();

                const estimatedVolume = gameCount * 0.1;
                document.getElementById('totalVolume').textContent = estimatedVolume.toFixed(2) + ' CORE';
                document.getElementById('activePlayers').textContent = '~' + Math.floor(gameCount / 2);

                // Hub Balance
                const hubBal = await provider.getBalance(CONTRACTS.HUB);
                document.getElementById('hubBalance').textContent = 
                    parseFloat(ethers.utils.formatEther(hubBal)).toFixed(4);

                // Rewards Balance
                const rewardsBal = await provider.getBalance(CONTRACTS.REWARDS);
                document.getElementById('rewardsBalance').textContent = 
                    parseFloat(ethers.utils.formatEther(rewardsBal)).toFixed(4);

                // Staking Balance
                const stakingBal = await provider.getBalance(CONTRACTS.STAKING);
                document.getElementById('stakingBalance').textContent = 
                    parseFloat(ethers.utils.formatEther(stakingBal)).toFixed(4);

                const totalStaked = await staking.totalSupply();
                document.getElementById('totalStakedAmount').textContent = 
                    parseFloat(ethers.utils.formatEther(totalStaked)).toFixed(4) + ' CORE';

                const userStake = await staking.balances(userAddress);
                document.getElementById('devStakedAmount').textContent = 
                    parseFloat(ethers.utils.formatEther(userStake)).toFixed(4) + ' CORE';

                // Dev Claimable
                const currentTime = Math.floor(Date.now() / 1000);
                const claimable = await rewards.getTotalClaimable(
                    userAddress,
                    ethers.constants.AddressZero,
                    currentTime
                );
                document.getElementById('devClaimable').textContent = 
                    parseFloat(ethers.utils.formatEther(claimable)).toFixed(4);

                const currentMonth = getCurrentMonthTimestamp();
                const devPot = await rewards.monthlyDevPotCORE(currentMonth);
                document.getElementById('devRevenue').textContent = 
                    parseFloat(ethers.utils.formatEther(devPot)).toFixed(4) + ' CORE';

                document.getElementById('activeGamesCount').textContent = Math.floor(gameCount / 2);
                document.getElementById('totalVolumeHub').textContent = estimatedVolume.toFixed(4) + ' CORE';

            } catch (error) {
                console.error('Error loading overview:', error);
            }
        }

        // ==================== ANALYTICS ====================
        function initCharts() {
            charts.revenue = new Chart(document.getElementById('revenueChart'), {
                type: 'line',
                data: {
                    labels: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7'],
                    datasets: [{
                        label: 'Dev Revenue (CORE)',
                        data: [0.01, 0.015, 0.025, 0.03, 0.027, 0.035, 0.04],
                        borderColor: 'rgb(102, 126, 234)',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: '#666' } } },
                    scales: {
                        y: { ticks: { color: '#999' }, grid: { color: '#e0e0e0' } },
                        x: { ticks: { color: '#999' }, grid: { color: '#e0e0e0' } }
                    }
                }
            });

            charts.games = new Chart(document.getElementById('gamesChart'), {
                type: 'bar',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Games Played',
                        data: [5, 8, 12, 10, 15, 20, 18],
                        backgroundColor: 'rgba(76, 175, 80, 0.8)',
                        borderColor: 'rgb(76, 175, 80)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: '#666' } } },
                    scales: {
                        y: { ticks: { color: '#999' }, grid: { color: '#e0e0e0' } },
                        x: { ticks: { color: '#999' }, grid: { color: '#e0e0e0' } }
                    }
                }
            });

            charts.feeDistribution = new Chart(document.getElementById('feeDistributionChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Dev (54%)', 'Cashback (14%)', 'Staking (14%)', 'Referral (10%)', 'Creator (8%)'],
                    datasets: [{
                        data: [54, 14, 14, 10, 8],
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(255, 152, 0, 0.8)',
                            'rgba(76, 175, 80, 0.8)',
                            'rgba(159, 122, 234, 0.8)',
                            'rgba(236, 201, 75, 0.8)'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { color: '#666', padding: 10, font: { size: 11 } } } }
                }
            });

            charts.poolBalances = new Chart(document.getElementById('poolBalancesChart'), {
                type: 'pie',
                data: {
                    labels: ['Hub', 'Rewards', 'Staking'],
                    datasets: [{
                        data: [0.195, 0.005, 0.007],
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(255, 152, 0, 0.8)',
                            'rgba(76, 175, 80, 0.8)'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { color: '#666', padding: 10, font: { size: 11 } } } }
                }
            });

            charts.gameTypes = new Chart(document.getElementById('gameTypesChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Chess', 'Checkers'],
                    datasets: [{
                        data: [60, 40],
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(255, 152, 0, 0.8)'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { color: '#666', padding: 10, font: { size: 11 } } } }
                }
            });
        }

        async function updateCharts() {
            if (charts.poolBalances) {
                const hubBal = await provider.getBalance(CONTRACTS.HUB);
                const rewardsBal = await provider.getBalance(CONTRACTS.REWARDS);
                const stakingBal = await provider.getBalance(CONTRACTS.STAKING);
                
                charts.poolBalances.data.datasets[0].data = [
                    parseFloat(ethers.utils.formatEther(hubBal)),
                    parseFloat(ethers.utils.formatEther(rewardsBal)),
                    parseFloat(ethers.utils.formatEther(stakingBal))
                ];
                charts.poolBalances.update();
            }

            if (charts.gameTypes) {
                const hub = new ethers.Contract(CONTRACTS.HUB, HUB_ABI, provider);
                const gameCount = await hub.gameCount();
                const chessGames = Math.floor(gameCount * 0.6);
                const checkersGames = gameCount - chessGames;
                charts.gameTypes.data.datasets[0].data = [chessGames, checkersGames];
                charts.gameTypes.update();
            }
        }

        async function updateAnalytics() {
            try {
                const hub = new ethers.Contract(CONTRACTS.HUB, HUB_ABI, provider);
                const gameCount = await hub.gameCount();
                const count = gameCount.toNumber();
                const avgStake = 0.1;
                const totalVolume = count * avgStake;
                const totalFees = totalVolume * 0.05;

                document.getElementById('analyticsGames').textContent = count;
                document.getElementById('analyticsVolume').textContent = totalVolume.toFixed(4) + ' CORE';
                document.getElementById('analyticsFees').textContent = totalFees.toFixed(4) + ' CORE';
                document.getElementById('analyticsDevRevenue').textContent = (totalFees * 0.54).toFixed(4) + ' CORE';
                document.getElementById('analyticsCashback').textContent = (totalFees * 0.14).toFixed(4) + ' CORE';
                document.getElementById('analyticsStakingRewards').textContent = (totalFees * 0.14).toFixed(4) + ' CORE';
                document.getElementById('analyticsReferrals').textContent = (totalFees * 0.10).toFixed(4) + ' CORE';
                document.getElementById('analyticsCreator').textContent = (totalFees * 0.08).toFixed(4) + ' CORE';
            } catch (e) {
                console.error('Analytics error:', e);
            }
        }

        // ==================== STAKING ====================
        async function loadStakingData() {
            try {
                const staking = new ethers.Contract(CONTRACTS.STAKING, STAKING_ABI, provider);
                
                const userStake = await staking.balances(userAddress);
                document.getElementById('yourStake').textContent = 
                    parseFloat(ethers.utils.formatEther(userStake)).toFixed(4) + ' CORE';

                const totalStaked = await staking.totalSupply();
                document.getElementById('platformTotalStaked').textContent = 
                    parseFloat(ethers.utils.formatEther(totalStaked)).toFixed(4) + ' CORE';

                if (totalStaked.gt(0)) {
                    const sharePercent = userStake.mul(10000).div(totalStaked).toNumber() / 100;
                    document.getElementById('yourPoolShare').textContent = sharePercent.toFixed(2) + '%';
                } else {
                    document.getElementById('yourPoolShare').textContent = '0%';
                }
            } catch (e) {
                console.error('Staking load error:', e);
            }
        }

        async function stakeTokens() {
            if (!signer) return alert('Connect wallet first');
            const amount = document.getElementById('stakeAmount').value;
            if (!amount || parseFloat(amount) <= 0) return alert('Enter valid amount');

            try {
                const staking = new ethers.Contract(CONTRACTS.STAKING, STAKING_ABI, signer);
                const stake = ethers.utils.parseEther(amount);
                const tx = await staking.stake({ value: stake });
                alert('Staking... please wait');
                await tx.wait();
                alert('‚úÖ Staked successfully!');
                await loadStakingData();
                await loadOverviewData();
            } catch (e) {
                alert('‚ùå Staking failed: ' + e.message);
            }
        }

        async function unstakeTokens() {
            if (!signer) return alert('Connect wallet first');
            const amount = document.getElementById('stakeAmount').value;
            if (!amount || parseFloat(amount) <= 0) return alert('Enter valid amount');

            try {
                const staking = new ethers.Contract(CONTRACTS.STAKING, STAKING_ABI, signer);
                const unstake = ethers.utils.parseEther(amount);
                const tx = await staking.withdraw(unstake);
                alert('Unstaking... please wait');
                await tx.wait();
                alert('‚úÖ Unstaked successfully!');
                await loadStakingData();
                await loadOverviewData();
            } catch (e) {
                alert('‚ùå Unstake failed: ' + e.message);
            }
        }

        async function claimStakingRewards() {
            if (!signer) return alert('Connect wallet first');
            try {
                const staking = new ethers.Contract(CONTRACTS.STAKING, STAKING_ABI, signer);
                const tx = await staking.claimRewards();
                alert('Claiming... please wait');
                await tx.wait();
                alert('‚úÖ Rewards claimed!');
                await loadStakingData();
                await updateDevBalance();
            } catch (e) {
                alert('‚ùå Claim failed: ' + e.message);
            }
        }

        async function topUpStaking() {
            const amount = document.getElementById('topUpAmount').value;
            if (!amount || amount <= 0) return alert('Enter valid amount');

            try {
                const staking = new ethers.Contract(CONTRACTS.STAKING, STAKING_ABI, signer);
                const value = ethers.utils.parseEther(amount);
                const tx = await staking.contributeFunds(value, { value });
                alert('Transaction sent! Waiting for confirmation...');
                await tx.wait();
                alert('‚úÖ Topped up staking pool!');
                document.getElementById('topUpAmount').value = '';
                await loadStakingData();
                await loadOverviewData();
            } catch (e) {
                alert('‚ùå Top up failed: ' + e.message);
            }
        }

        // ==================== PHASE MANAGEMENT ====================
        async function checkAllPhases() {
            await Promise.all([
                checkPhase2Status(),
                checkPhase3Status(),
                checkPhase4Status()
            ]);
        }

        async function checkPhase2Status() {
            try {
                const gateway = new ethers.Contract(CONTRACTS.TOKEN_GATEWAY, GATEWAY_ABI, provider);
                const enabled = await gateway.enabled();
                updatePhaseStatus(2, enabled);
            } catch (error) {
                updatePhaseStatus(2, false);
            }
        }

        async function checkPhase3Status() {
            try {
                const bridge = new ethers.Contract(CONTRACTS.BRIDGE, BRIDGE_ABI, provider);
                const tournament = new ethers.Contract(CONTRACTS.TOURNAMENT, TOURNAMENT_ABI, provider);
                const bridgeEnabled = await bridge.enabled();
                const tournamentEnabled = await tournament.enabled();
                const enabled = bridgeEnabled && tournamentEnabled;
                updatePhaseStatus(3, enabled);
            } catch (error) {
                updatePhaseStatus(3, false);
            }
        }

        async function checkPhase4Status() {
            try {
                const dao = new ethers.Contract(CONTRACTS.DAO, DAO_ABI, provider);
                const enabled = await dao.enabled();
                updatePhaseStatus(4, enabled);
            } catch (error) {
                updatePhaseStatus(4, false);
            }
        }

        function updatePhaseStatus(phase, enabled) {
            const dot = document.getElementById(`phase${phase}Dot`);
            const badge = document.getElementById(`phase${phase}StatusBadge`);
            const text = document.getElementById(`phase${phase}StatusText`);

            if (enabled) {
                dot.classList.add('green');
                dot.classList.remove('red');
                badge.textContent = 'ENABLED';
                badge.className = 'badge badge-success';
                text.textContent = 'Operational';
            } else {
                dot.classList.add('red');
                dot.classList.remove('green');
                badge.textContent = 'DISABLED';
                badge.className = 'badge badge-warning';
                text.textContent = 'Not activated';
            }

            const card = document.getElementById(`phase${phase}Card`);
            const phaseBadge = document.getElementById(`phase${phase}Badge`);
            const btn = document.getElementById(`phase${phase}Btn`);

            if (enabled) {
                card.classList.add('enabled');
                phaseBadge.textContent = 'ENABLED';
                phaseBadge.className = 'badge badge-success';
                btn.textContent = '‚úÖ Enabled';
                btn.disabled = true;
                btn.className = 'btn btn-secondary';
            } else {
                card.classList.remove('enabled');
                phaseBadge.textContent = 'DISABLED';
                phaseBadge.className = 'badge badge-warning';
                btn.textContent = `üöÄ Enable Phase ${phase}`;
                btn.disabled = false;
                btn.className = 'btn btn-primary';
            }
        }

        async function enablePhase2() {
            const btn = document.getElementById('phase2Btn');
            const status = document.getElementById('phase2Status');
            btn.textContent = '‚è≥ Enabling...';
            btn.disabled = true;
            status.innerHTML = '<p style="color: #666;">Sending transaction...</p>';

            try {
                const gateway = new ethers.Contract(CONTRACTS.TOKEN_GATEWAY, GATEWAY_ABI, signer);
                const tx = await gateway.enable();
                status.innerHTML = '<p style="color: #666;">Waiting for confirmation...</p>';
                await tx.wait();
                status.innerHTML = '<p style="color: #4caf50; font-weight: bold;">‚úÖ Phase 2 Enabled!</p>';
                await checkPhase2Status();
            } catch (error) {
                status.innerHTML = '<p style="color: #f44336;">‚ùå ' + error.message + '</p>';
                btn.textContent = 'üöÄ Enable Phase 2';
                btn.disabled = false;
            }
        }

        async function enablePhase3() {
            const btn = document.getElementById('phase3Btn');
            const status = document.getElementById('phase3Status');
            btn.textContent = '‚è≥ Enabling...';
            btn.disabled = true;
            status.innerHTML = '<p style="color: #666;">Step 1/2: Enabling Bridge...</p>';

            try {
                const bridge = new ethers.Contract(CONTRACTS.BRIDGE, BRIDGE_ABI, signer);
                const tx1 = await bridge.enable();
                await tx1.wait();
                status.innerHTML = '<p style="color: #666;">Step 2/2: Enabling Tournaments...</p>';
                const tournament = new ethers.Contract(CONTRACTS.TOURNAMENT, TOURNAMENT_ABI, signer);
                const tx2 = await tournament.enable();
                await tx2.wait();
                status.innerHTML = '<p style="color: #4caf50; font-weight: bold;">‚úÖ Phase 3 Enabled!</p>';
                await checkPhase3Status();
            } catch (error) {
                status.innerHTML = '<p style="color: #f44336;">‚ùå ' + error.message + '</p>';
                btn.textContent = 'üöÄ Enable Phase 3';
                btn.disabled = false;
            }
        }

        async function enablePhase4() {
            const btn = document.getElementById('phase4Btn');
            const status = document.getElementById('phase4Status');
            btn.textContent = '‚è≥ Enabling...';
            btn.disabled = true;
            status.innerHTML = '<p style="color: #666;">Step 1/2: Enabling DAO...</p>';

            try {
                const dao = new ethers.Contract(CONTRACTS.DAO, DAO_ABI, signer);
                const tx1 = await dao.enable();
                await tx1.wait();
                status.innerHTML = '<p style="color: #666;">Step 2/2: Enabling REALM trading...</p>';
                const realm = new ethers.Contract(CONTRACTS.REALM_TOKEN, REALM_ABI, signer);
                const tx2 = await realm.enableTrading();
                await tx2.wait();
                status.innerHTML = '<p style="color: #4caf50; font-weight: bold;">‚úÖ Phase 4 Enabled!</p>';
                await checkPhase4Status();
            } catch (error) {
                status.innerHTML = '<p style="color: #f44336;">‚ùå ' + error.message + '</p>';
                btn.textContent = 'üöÄ Enable Phase 4';
                btn.disabled = false;
            }
        }

        // ==================== TREASURY ====================
        async function loadTreasuryData() {
            try {
                const rewards = new ethers.Contract(CONTRACTS.REWARDS, REWARDS_ABI, provider);
                const currentMonth = getCurrentMonthTimestamp();
                const devPot = await rewards.monthlyDevPotCORE(currentMonth);
                document.getElementById('treasuryClaimable').textContent = 
                    ethers.utils.formatEther(devPot) + ' CORE';

                const balance = await provider.getBalance(CONTRACTS.REWARDS);
                document.getElementById('treasuryContractBalance').textContent = 
                    ethers.utils.formatEther(balance) + ' CORE';

                populateMonthSelector();
            } catch (error) {
                console.error('Treasury load error:', error);
            }
        }

        function populateMonthSelector() {
            const select = document.getElementById('claimMonth');
            select.innerHTML = '';
            const now = new Date();
            for (let i = 0; i < 12; i++) {
                const date = new Date(now.getFullYear(), now.getMonth() - i, 1);
                const monthName = date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                const timestamp = Math.floor(date.getTime() / 1000);
                const option = document.createElement('option');
                option.value = timestamp;
                option.textContent = monthName;
                select.appendChild(option);
            }
            select.addEventListener('change', updateClaimAmount);
            updateClaimAmount();
        }

        async function updateClaimAmount() {
            const select = document.getElementById('claimMonth');
            const timestamp = select.value;
            try {
                const rewards = new ethers.Contract(CONTRACTS.REWARDS, REWARDS_ABI, provider);
                const amount = await rewards.monthlyDevPotCORE(timestamp);
                document.getElementById('claimAmount').textContent = 
                    ethers.utils.formatEther(amount) + ' CORE';
            } catch (error) {}
        }

        async function claimDevPot() {
            await claimDevPotForMonth();
        }

        async function claimDevPotForMonth() {
            const select = document.getElementById('claimMonth');
            const timestamp = select.value;
            if (!confirm(`Claim dev revenue for this month?`)) return;

            try {
                const rewards = new ethers.Contract(CONTRACTS.REWARDS, REWARDS_ABI, signer);
                const monthStart = Math.floor(timestamp / (30 * 24 * 60 * 60)) * (30 * 24 * 60 * 60);
                const tx = await rewards.devWithdrawCORE(monthStart);
                alert('Transaction sent! Waiting for confirmation...');
                await tx.wait();
                alert('‚úÖ Successfully claimed dev revenue!');
                await loadTreasuryData();
                await updateDevBalance();
            } catch (error) {
                alert('‚ùå Claim failed: ' + error.message);
            }
        }

        async function claimDevRevenue() {
            if (!signer) return alert('Connect wallet first');
            try {
                const rewards = new ethers.Contract(CONTRACTS.REWARDS, REWARDS_ABI, signer);
                const currentTime = Math.floor(Date.now() / 1000);
                const tx = await rewards.claimRewards(userAddress, ethers.constants.AddressZero, currentTime);
                alert('Claiming revenue... please wait');
                await tx.wait();
                alert('‚úÖ Revenue claimed!');
                await loadOverviewData();
                await updateDevBalance();
            } catch (e) {
                alert('‚ùå Claim failed: ' + e.message);
            }
        }

        // ==================== POOLS ====================
        async function loadPoolData() {
            try {
                const hubBalance = await provider.getBalance(CONTRACTS.HUB);
                const tournamentPool = parseFloat(ethers.utils.formatEther(hubBalance)) * 0.1;
                
                document.getElementById('tournamentPoolSize').textContent = tournamentPool.toFixed(4) + ' CORE';
                document.getElementById('totalPoolValue').textContent = tournamentPool.toFixed(2);
                document.getElementById('communityContributions').textContent = (tournamentPool * 0.3).toFixed(4) + ' CORE';
                document.getElementById('platformContributions').textContent = (tournamentPool * 0.7).toFixed(4) + ' CORE';
                document.getElementById('contributorsCount').textContent = '12';
                document.getElementById('averageContribution').textContent = (tournamentPool / 12).toFixed(3);
            } catch (error) {
                console.error('Pool load error:', error);
            }
        }

        async function contributeToTournamentPool() {
            const amount = document.getElementById('poolContributionAmount').value;
            if (!amount || amount <= 0) return alert('Enter valid amount');
            if (!confirm(`Contribute ${amount} CORE to tournament pool?`)) return;

            try {
                const value = ethers.utils.parseEther(amount);
                const tx = await signer.sendTransaction({ to: CONTRACTS.HUB, value, gasLimit: 100000 });
                alert('Transaction sent!');
                await tx.wait();
                alert('‚úÖ Thank you for your contribution!');
                document.getElementById('poolContributionAmount').value = '';
                await loadPoolData();
            } catch (e) {
                alert('‚ùå Contribution failed: ' + e.message);
            }
        }

        async function contributeToStakingPool() {
            const amount = document.getElementById('stakingPoolAmount').value;
            if (!amount || amount <= 0) return alert('Enter valid amount');
            if (!confirm(`Contribute ${amount} CORE to staking pool?`)) return;

            try {
                const staking = new ethers.Contract(CONTRACTS.STAKING, STAKING_ABI, signer);
                const value = ethers.utils.parseEther(amount);
                const tx = await staking.contributeFunds(value, { value });
                alert('Transaction sent!');
                await tx.wait();
                alert('‚úÖ Contributed to staking pool!');
                document.getElementById('stakingPoolAmount').value = '';
                await loadStakingData();
            } catch (e) {
                alert('‚ùå Contribution failed: ' + e.message);
            }
        }

        async function contributeToRewardsPool() {
            const amount = document.getElementById('rewardsPoolAmount').value;
            if (!amount || amount <= 0) return alert('Enter valid amount');
            if (!confirm(`Contribute ${amount} CORE to rewards pool?`)) return;

            try {
                const value = ethers.utils.parseEther(amount);
                const tx = await signer.sendTransaction({ to: CONTRACTS.REWARDS, value, gasLimit: 100000 });
                alert('Transaction sent!');
                await tx.wait();
                alert('‚úÖ Contributed to rewards pool!');
                document.getElementById('rewardsPoolAmount').value = '';
                await loadOverviewData();
            } catch (e) {
                alert('‚ùå Contribution failed: ' + e.message);
            }
        }

        // ==================== GAMES ====================
        async function loadGamesData() {
            const tbody = document.getElementById('gamesTableBody');
            tbody.innerHTML = '<tr><td colspan="6" class="loading"><div class="spinner"></div>Loading games...</td></tr>';

            try {
                const hub = new ethers.Contract(CONTRACTS.HUB, HUB_ABI, provider);
                const gameCount = await hub.gameCount();
                let activeCount = 0;
                const rows = [];

                const start = Math.max(1, gameCount - 19);
                for (let i = gameCount; i >= start; i--) {
                    try {
                        const game = await hub.games(i);
                        if (game.active) {
                            activeCount++;
                            rows.push(`
                                <tr>
                                    <td>#${game.id}</td>
                                    <td>${game.gameType}</td>
                                    <td>${ethers.utils.formatEther(game.stake)} CORE</td>
                                    <td>${game.player2 !== ethers.constants.AddressZero ? '2/2' : '1/2'}</td>
                                    <td><span class="badge badge-success">Active</span></td>
                                    <td><button class="btn btn-secondary" onclick="viewGame(${game.id})">View</button></td>
                                </tr>
                            `);
                        }
                    } catch (error) {}
                }

                document.getElementById('liveActiveGamesCount').textContent = activeCount;
                tbody.innerHTML = rows.length > 0 ? rows.join('') : 
                    '<tr><td colspan="6" style="text-align: center; padding: 40px;">No active games</td></tr>';
            } catch (error) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #f44336;">Error loading games</td></tr>';
            }
        }

        function viewGame(gameId) {
            window.open(`https://scan.coredao.org/tx/${gameId}`, '_blank');
        }

        // ==================== SETTINGS ====================
        function updateContractAddresses() {
            document.getElementById('hubAddress').textContent = CONTRACTS.HUB;
            document.getElementById('rewardsAddress').textContent = CONTRACTS.REWARDS;
            document.getElementById('stakingAddress').textContent = CONTRACTS.STAKING;
            document.getElementById('nftAddress').textContent = CONTRACTS.NFT;
            document.getElementById('chatAddress').textContent = CONTRACTS.GAME_CHAT;
            document.getElementById('gatewayAddress').textContent = CONTRACTS.TOKEN_GATEWAY;
            document.getElementById('bridgeAddress').textContent = CONTRACTS.BRIDGE;
            document.getElementById('tournamentAddress').textContent = CONTRACTS.TOURNAMENT;
            document.getElementById('daoAddress').textContent = CONTRACTS.DAO;
            document.getElementById('realmAddress').textContent = CONTRACTS.REALM_TOKEN;
        }

        function copyAddress(type) {
            let address;
            switch(type) {
                case 'hub': address = CONTRACTS.HUB; break;
                case 'rewards': address = CONTRACTS.REWARDS; break;
                case 'staking': address = CONTRACTS.STAKING; break;
                case 'nft': address = CONTRACTS.NFT; break;
                case 'chat': address = CONTRACTS.GAME_CHAT; break;
                case 'gateway': address = CONTRACTS.TOKEN_GATEWAY; break;
                case 'bridge': address = CONTRACTS.BRIDGE; break;
                case 'tournament': address = CONTRACTS.TOURNAMENT; break;
                case 'dao': address = CONTRACTS.DAO; break;
                case 'realm': address = CONTRACTS.REALM_TOKEN; break;
            }
            navigator.clipboard.writeText(address);
            alert('‚úÖ Copied to clipboard!');
        }

        async function pausePlatform() {
            if (!confirm('PAUSE the platform? This will prevent new game creation.')) return;
            try {
                const hub = new ethers.Contract(CONTRACTS.HUB, HUB_ABI, signer);
                const tx = await hub.pause();
                alert('Transaction sent!');
                await tx.wait();
                alert('‚úÖ Platform paused!');
            } catch (e) {
                alert('‚ùå Pause failed: ' + e.message);
            }
        }

        async function unpausePlatform() {
            if (!confirm('Resume platform operations?')) return;
            try {
                const hub = new ethers.Contract(CONTRACTS.HUB, HUB_ABI, signer);
                const tx = await hub.unpause();
                alert('Transaction sent!');
                await tx.wait();
                alert('‚úÖ Platform resumed!');
            } catch (e) {
                alert('‚ùå Unpause failed: ' + e.message);
            }
        }

        // ==================== UTILITIES ====================
        function getCurrentMonthTimestamp() {
            const now = new Date();
            const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
            return Math.floor(monthStart.getTime() / 1000);
        }

        async function refreshData() {
            await initializeDashboard();
            alert('‚úÖ Data refreshed!');
        }

        function exportData() {
            alert('Export functionality coming soon!');
        }
    </script>
</body>
</html>
